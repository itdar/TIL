# IoC, DI, AOP 에 관한 핵심 (SpringFramework)

20210803  
현 시점에서 이해한대로 정리한다.

아래 순서로 정리

- IoC 개념
- DI 개념
- AOP 개념
- IoC, DI, AOP 의 관계
- 그래서 스프링에서 사용되는 방식은? (IoC Container)

### IoC 란? (Inversion of Control, 제어의 역전)
> 사용하는 객체의 직접 의존하지 않고, 생명주기를 제어하는(관리하는) 주체가 제3자(e.g. 프레임워크)가 되도록 한다.
>
> e.g. A -> B 를 의존하며 관리하고 있었는데, A 는 C 를 통해서 관리되는 B 를 받아다가(DI) 쓰기만 한다.

처음에 Inversion 이라는 단어를 보고, 객체지향 원칙 중 DIP (Dependency Inversion Principle) 가 떠올랐지만 다른 개념

어느 객체에서 사용하는 객체를 의존해서 라이프사이클을 관리하던 것(Composition) 에서,   
사용하는 객체 의존의 라이프사이클 관리를 하지 않고(Aggregation) 느슨한 결합을 유지하도록 주입(DI) 받아서 사용 하도록 한다.

### DI 란? (Dependency Injection, 의존성 주입)
> 어느 객체에서 사용하는 멤버(attribute)를 외부로부터 주입 받아서 사용한다.
>
> - 생성자에서 주입받는 방식
> - setter로 주입받는 방식

이 때, Interface를 써서 (객체지향 원칙 중 **DIP** 개념과 **OCP** 개념에 맞게) 의존을 낮추고 확장성을 높이는 효과를 극대화 할 수 있겠다.

- 참고: DL(Dependency Lookup) - 저장소에 저장되어 있는 Bean에 접근 하기위해 컨테이너가 제공하는 API를 이용하여 Bean을 검색하는 것

### AOP 란? (Aspect Origented Programming, 관점 지향 프로그래밍)
> 비지니스 로직 등으로 진행되는 과정을 Vertical(수직) 하게 보았을 때,
>
> Horizontal(수평) 관점에서 바라보고 공통으로 들어갈 로직을 필요한 부분에 삽입한다.

예를 들면,
* 주문 -> 결제 -> 배달 -> 완료

위와 같은 각 로직은 **세로** 로 진행되는 관점으로 바라본다.

* 소요시간, 성공여부, 로그인, 트랜잭션, 캐싱 등

위와 같은 공통 기능이 될 수 있는 것들은, 아래처럼 필요한 세로 방향 진행 로직에 **가로** 로 삽입해 넣는 관점으로 바라본다.

| | 주문 | 결제 | 배달 | 완료
|---|---|---|---|---
|소요시간 삽입여부| | |ㅇ| ㅇ|
|성공여부 삽입여부|ㅇ|ㅇ|ㅇ||
|로그인 삽입여부|ㅇ|ㅇ|ㅇ|ㅇ|
|트랜잭션 삽입여부|ㅇ|ㅇ|||
|캐싱 삽입여부|ㅇ| |ㅇ||

- 참고: Cross-cutting concern - 위의 중복으로 쓰이는 가로 방향의 관점 관심사

---------------

## IoC, DI, AOP 의 관계

> IoC 개념을 구현하면, DI 개념을 쉽게 사용한다.
- 왜냐면, IoC 개념에 따라 의존을 느슨하게 하기 위해서 생성하는 Composition 보다는 **Aggregation** 으로 구현해야 한다.
- 그래서, **의존성 주입(DI)** 을 통해서 제 3자로부터 사용하려는 객체를 주입 받는다.


> IoC 개념이 구현하면, AOP 라는 개념을 쉽게 사용한다.
- 왜냐면, AOP 가 사용될 때, 공통 관심(가로 방향) 기능이 있는 클래스는 IoC 컨테이너에서 관리되는 Bean 등록을 해서 사용한다.
- 그래서, 어떤 세로 방향 기능을 실행 할 때 실행하려는 것이 AOP 가 적용되는 것이라면,  
  실행 메서드나 클래스의 위치에 맞는 AOP 메서드를 가져와서 Proxy 패턴으로 감싸서 사용되도록 한다.

## 그래서 각 개념들이 스프링에서 사용되는 방식은?

#### IoC
스프링 IoC 컨테이너가 Bean 과 같이 사용된다.
> Bean: 스프링프레임워크 컨테이너에서 라이프사이클을 관리하도록 등록된 객체들

1. 실행 시 IoC 컨테이너에 등록하고자 하는 Bean 들을 미리 만들어서 넣어둔다. (@Bean, @Component, ..etc)
2. 사용 시에 컨테이너에서 주입 받아서 사용한다. (@Autowired, @Resource, ..etc)

#### DI
위의 IoC 컨테이너에 등록된 Bean 들을 **주입** 받아서 사용하는 개념

#### AOP
AOP로 사용할 메서드가 포함된 클래스를 IoC 컨테이너에 등록 + @Aspect 설정하면,  
타겟이 되는 메서드나 클래스들을 원하는 기능으로 감싸는 Proxy 객체를 만들어서 사용한다.

- 참고 1: AOP 기능을 위해서 가로로 삽입되는 기능은 세로의 기능을 **Proxy** 로 감싼다.
- 참고 2: AOP 가능을 삽입 할 때, 시작 전/후/앞뒤 등 위치와 범위를 정하는 @어노테이션이 다양하다.

----
#### Reference
인프런 스프링 강의 (김영한님)  
블로그들.. 여기저기 너무 많이..


